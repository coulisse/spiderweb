class table_builder{constructor(e){this.selector=e,this.current_data=[]}getLastRowId(){let e;return e=null==this.current_data||this.current_data.length<1?0:this.current_data[0].rowid}resetData(){this.current_data=[]}#buildRow(e,t,n,a=""){var l=document.createElement("tr"),t=(0<a.length||t&&(l.className="table-info"),document.createElement("i")),r=(t.className="bi-search",t.role="button",t.ariaLabel=e.de,document.createElement("a")),d=(r.href=qrz_url+e.de,r.target="_blank",r.rel="noopener",document.createElement("span")),o=(e.de==a?((o=document.createElement("mark")).textContent=e.de,d.appendChild(o)):d.textContent=" "+e.de,document.createElement("td")),t=(r.appendChild(t),o.appendChild(r),o.appendChild(d),l.append(o),Intl.NumberFormat("it-IT",{style:"decimal"}).format(e.freq)),r=document.createElement("span"),d=(r.className="badge bg-warning text-dark badge-responsive",r.textContent=t,document.createElement("td")),o=(d.appendChild(r),l.appendChild(d),findAdxo(my_adxo_events,e.dx)),t="<a href="+adxo_url+" target=_blank rel=noopener >NG3K Website</a>",r=document.createElement("i"),d=(r.className="bi-search",r.role="button",r.ariaLabel=e.dx,document.createElement("a")),c=(d.href=qrz_url+e.dx,d.target="_blank",d.rel="noopener",document.createElement("span")),s=document.createElement("mark"),s=(s.textContent=e.dx,e.dx==a?c.appendChild(s):c.textContent=" "+e.dx,null!=o&&((a=document.createElement("i")).tabIndex=0,a.className="bi-megaphone-fill",a.style="color: cornflowerblue;",a.role="button",a.ariaLabel="dx_operations",a.setAttribute("data-bs-container","body"),a.setAttribute("data-bs-toggle","popover"),a.setAttribute("data-bs-trigger","focus"),a.setAttribute("data-bs-sanitizer","true"),a.setAttribute("data-bs-placement","auto"),a.setAttribute("data-bs-html","true"),a.setAttribute("data-bs-title","Announced DX Op.: "+o.summary),a.setAttribute("data-bs-content",o.description+"data from  "+t),c.appendChild(a)),document.createElement("td"));d.appendChild(r),s.appendChild(d),s.append(c),l.appendChild(s);try{var i=document.createElement("span"),u=(i.className="img-flag fi fi-"+e.iso,i.setAttribute("data-bs-container","body"),i.setAttribute("data-bs-toggle","popover"),i.setAttribute("data-bs-trigger","hover"),i.setAttribute("data-bs-placement","left"),i.setAttribute("data-bs-content",e.country),document.createElement("td"));u.appendChild(i),l.appendChild(u)}catch(e){console.log(e),console.log("error creating flag");o=document.createElement("td");l.appendChild(o)}t=document.createElement("td"),t.className="d-none d-lg-table-cell d-xl-table-cell",t.textContent=e.country,l.appendChild(t),a=document.createElement("td");a.className="d-none d-lg-table-cell d-xl-table-cell";try{a.textContent=e.comm.substring(0,100)}catch(e){a.textContent=""}l.appendChild(a);let m=new Date(1e3*e.time),p="00"+m.getUTCHours(),b=(p=p.substring(p.length-2,p.length),"00"+m.getMinutes()),g=(b=b.substring(b.length-2,b.length),"00"+m.getUTCDate()),h=(g=g.substring(g.length-2,g.length),"00"+(Number(m.getUTCMonth())+1));h=h.substring(h.length-2,h.length);r=m.getUTCFullYear(),d=p+":"+b,m=g+"/"+h+"/"+r,c=document.createElement("div"),c.className="d-flex flex-column",s=document.createElement("div");return s.textContent=d,c.appendChild(s),m!=n&&((i=document.createElement("div")).textContent=m,c.appendChild(i)),l.appendChild(c),l}build(n,a){if(null!=n){var l=new Date;let e="00"+l.getUTCDate(),t=(e=e.substring(e.length-2,e.length),"00"+(Number(l.getUTCMonth())+1));t=t.substring(t.length-2,t.length);var l=l.getUTCFullYear(),r=e+"/"+t+"/"+l,d=(document.getElementById(this.selector).replaceChildren(),[]);for(let e=0;e<n.length;e++)document.getElementById(this.selector).append(this.#buildRow(n[e],!0,r,a)),d.push(n[e]);for(let e=0;e<this.current_data.length-n.length;e++)document.getElementById(this.selector).append(this.#buildRow(this.current_data[e],!1,r,a)),d.push(this.current_data[e]);this.current_data=d;[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(e){return new bootstrap.Popover(e)})}}}const adxo_url="https://www.ng3k.com/misc/adxo.html",qrz_url="https://www.qrz.com/db/",tb=new table_builder("bodyspot");var qryAll_sv="";function findAdxo(t,n){if(t)for(let e=0;e<t.length;e++)if(t[e].callsign==n)return t[e]}function mySearch(e){e.preventDefault(),refresh_timer()}function getFilter(e,t,n,a){try{var l,r=[].map.call(document.getElementById(e).selectedOptions,e=>e.value);(r.length<n||-1==n)&&(l=r.map(function(e){return e?t+"="+e:""}).join("&"),"&"==(a=a.concat("&".concat(l))).substring(0,1))&&(a=a.substring(1))}catch(e){if("TypeError"!=e.name)throw e}return a}function refresh_timer(){var e=getFilter("band","b",14,"");e=getFilter("de_re","e",7,e),e=getFilter("dx_re","x",7,e),e=getFilter("mode","m",3,e),e=getFilter("cqdeInput","qe",-1,e);let t;(e=getFilter("cqdxInput","qx",-1,e))!=qryAll_sv&&(tb.resetData(),qryAll_sv=e),t="spotlist?lr=".concat(tb.getLastRowId()),e&&(t=t.concat("&".concat(e))),fetch(t).then(e=>e.json()).then(t=>{try{tb.build(t)}catch(e){console.log(e),console.log(e.stack),console.log(t)}})}
