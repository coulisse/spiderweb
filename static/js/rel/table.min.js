class table_builder{constructor(e){this.selector=e,this.current_data=[],this.first_time=!0}getLastRowId(){let e;return e=null==this.current_data||this.current_data.length<1?0:this.current_data[0].rowid}resetData(){this.current_data=[]}#buildRow(e,t,n,a=""){var r=document.createElement("tr"),t=(0<a.length||t&&!this.first_time&&(r.className="table-info"),document.createElement("i")),l=(t.className="bi-search",t.role="button",t.ariaLabel=e.de,document.createElement("a")),o=(l.href=qrz_url+e.de,l.target="_blank",l.rel="noopener",document.createElement("span")),d=(e.de==a?((d=document.createElement("mark")).textContent=e.de,o.appendChild(d)):o.textContent=" "+e.de,document.createElement("td")),t=(l.appendChild(t),d.appendChild(l),d.appendChild(o),r.append(d),Intl.NumberFormat("it-IT",{style:"decimal"}).format(e.freq)),l=document.createElement("span"),o=(l.className="badge bg-warning text-dark badge-responsive",l.textContent=t,document.createElement("td")),d=(o.appendChild(l),r.appendChild(o),findAdxo(my_adxo_events,e.dx)),t="<a href="+adxo_url+" target=_blank rel=noopener >NG3K Website</a>",l=document.createElement("i"),o=(l.className="bi-search",l.role="button",l.ariaLabel=e.dx,document.createElement("a")),s=(o.href=qrz_url+e.dx,o.target="_blank",o.rel="noopener",document.createElement("span")),i=document.createElement("mark"),i=(i.textContent=e.dx,e.dx==a?s.appendChild(i):s.textContent=" "+e.dx,null!=d&&((a=document.createElement("i")).tabIndex=0,a.className="bi-megaphone-fill",a.style="color: cornflowerblue;",a.role="button",a.ariaLabel="dx_operations",a.setAttribute("data-bs-container","body"),a.setAttribute("data-bs-toggle","popover"),a.setAttribute("data-bs-trigger","focus"),a.setAttribute("data-bs-sanitizer","true"),a.setAttribute("data-bs-placement","auto"),a.setAttribute("data-bs-html","true"),a.setAttribute("data-bs-title","Announced DX Op.: "+d.summary),a.setAttribute("data-bs-content",d.description+"data from  "+t),s.appendChild(a)),document.createElement("td"));o.appendChild(l),i.appendChild(o),i.append(s),r.appendChild(i);try{var c=document.createElement("span"),m=(c.className="img-flag fi fi-"+e.iso,c.setAttribute("data-bs-container","body"),c.setAttribute("data-bs-toggle","popover"),c.setAttribute("data-bs-trigger","hover"),c.setAttribute("data-bs-placement","left"),c.setAttribute("data-bs-content",e.country),document.createElement("td"));m.appendChild(c),r.appendChild(m)}catch(e){console.log(e),console.log("error creating flag");d=document.createElement("td");r.appendChild(d)}t=document.createElement("td"),t.className="d-none d-lg-table-cell d-xl-table-cell",t.textContent=e.country,r.appendChild(t),a=document.createElement("td");a.className="d-none d-lg-table-cell d-xl-table-cell";try{a.textContent=e.comm.substring(0,100)}catch(e){a.textContent=""}r.appendChild(a);let u=new Date(1e3*e.time),p="00"+u.getUTCHours(),h=(p=p.substring(p.length-2,p.length),"00"+u.getMinutes()),b=(h=h.substring(h.length-2,h.length),"00"+u.getUTCDate()),g=(b=b.substring(b.length-2,b.length),"00"+(Number(u.getUTCMonth())+1));g=g.substring(g.length-2,g.length);l=u.getUTCFullYear(),o=p+":"+h,u=b+"/"+g+"/"+l,s=document.createElement("div"),s.className="d-flex flex-column",i=document.createElement("div");return i.textContent=o,s.appendChild(i),u!=n&&((c=document.createElement("div")).textContent=u,s.appendChild(c)),r.appendChild(s),r}build(n,a){if(null!=n){var r=new Date;let e="00"+r.getUTCDate(),t=(e=e.substring(e.length-2,e.length),"00"+(Number(r.getUTCMonth())+1));t=t.substring(t.length-2,t.length);var r=r.getUTCFullYear(),l=e+"/"+t+"/"+r,o=(document.getElementById(this.selector).replaceChildren(),[]);for(let e=0;e<n.length;e++)document.getElementById(this.selector).append(this.#buildRow(n[e],!0,l,a)),o.push(n[e]);for(let e=0;e<this.current_data.length-n.length;e++)document.getElementById(this.selector).append(this.#buildRow(this.current_data[e],!1,l,a)),o.push(this.current_data[e]);this.current_data=o;[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(e){return new bootstrap.Popover(e)});this.first_time=!1}}}let adxo_url="https://www.ng3k.com/misc/adxo.html",qrz_url="https://www.qrz.com/db/",tb=new table_builder("bodyspot");var params_sv={};function findAdxo(t,n){if(t)for(let e=0;e<t.length;e++)if(t[e].callsign==n)return t[e]}function mySearch(e){e.preventDefault(),refresh_timer()}function compose_filter(t,e,n){try{var a;0==e?n[t]=document.getElementById(t).checked:(a=[].map.call(document.getElementById(t).selectedOptions,e=>e.value)).length<e?(n[t]=[],a.map(function(e){if(!e)return"";n[t].push(e)})):-1==e&&a.map(function(e){if(!e)return"";n[t]=e})}catch(e){if(!(e instanceof TypeError))throw e;console.log(e.name+" managed - it is ok: probabilly ther is no filter on cq region")}return n}function refresh_timer(){var e=compose_filter("dxcalls",14,e={});e=compose_filter("band",14,e),e=compose_filter("de_re",7,e),e=compose_filter("dx_re",7,e),e=compose_filter("mode",3,e),e=compose_filter("cqdeInput",-1,e),e=compose_filter("cqdxInput",-1,e),e=compose_filter("exclft8",0,e),e=compose_filter("exclft4",0,e),delete params_sv.lr,JSON.stringify(e)!==JSON.stringify(params_sv)&&(tb.resetData(),params_sv=e),e.lr=tb.getLastRowId(),fetch("spotlist",{method:"POST",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(t=>{try{tb.build(t)}catch(e){console.log(e),console.log(e.stack),console.log(t)}})}
